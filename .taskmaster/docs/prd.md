<context>
# Overview
A local Zed editor extension providing AutoHotkey v1 language support. Currently, Zed has no AHK support, which means vim-style commenting (`gcc`) and `Ctrl+/` don't work in `.ahk` files. No tree-sitter grammar for AutoHotkey exists publicly, so we need to create one from scratch.

Target user: Alfredo, who uses Zed as his primary editor and works extensively with AutoHotkey v1 scripts.

# Core Features
1. **Comment Toggling** - Enable `gcc` (vim mode) and `Ctrl+/` to toggle line comments using `;` syntax
2. **Syntax Highlighting** - Color-code keywords, strings, numbers, functions, comments, hotkeys, and labels

# User Experience
- Install as a local dev extension (not published to marketplace)
- After installation, `.ahk` files automatically get syntax highlighting
- Vim mode `gcc` and `Ctrl+/` work to toggle comments
- No additional configuration needed by user
</context>

<PRD>
# Technical Architecture

## System Components
1. **Tree-sitter Grammar** (`grammar.js`) - Parser rules for AHK v1 syntax
2. **Zed Extension Manifest** (`extension.toml`) - Extension metadata and grammar registration
3. **Language Config** (`config.toml`) - File associations and comment syntax
4. **Highlight Queries** (`highlights.scm`) - Maps syntax nodes to theme colors

## Project Structure
```
C:\Users\Alfredo\Documents\GitHub\tree-sitter-autohotkey\
├── extension.toml
├── package.json
├── grammar.js
├── src/                    # Generated by tree-sitter
├── languages/
│   └── autohotkey/
│       ├── config.toml
│       └── highlights.scm
```

## Dependencies
- Node.js (runtime for tree-sitter CLI)
- tree-sitter-cli (npm package)

# Development Roadmap

## Phase 1: MVP - Comments Only
- Set up project scaffolding with tree-sitter init
- Create minimal grammar.js that parses comments only (line `;` and block `/* */`)
- Create extension.toml and config.toml
- Create basic highlights.scm for comments
- Install as dev extension and verify `gcc` works

## Phase 2: Core Syntax Highlighting
- Add string parsing (`"..."` and `'...'`)
- Add number parsing (integers, hex `0xFF`, floats)
- Add keyword recognition (`if`, `else`, `while`, `loop`, `return`, `class`, `global`, `local`, `break`, `continue`)
- Update highlights.scm with new node types

## Phase 3: Functions and Labels
- Add function definition parsing `FuncName() { }`
- Add function call parsing `FuncName()`
- Add label parsing `LabelName:`
- Add hotkey parsing `^a::`, `#n::`, `!+c::`
- Add directive parsing `#Include`, `#NoEnv`

# Logical Dependency Chain
1. **Project setup** - Must scaffold project first with tree-sitter init
2. **Minimal grammar** - Comments are simplest, prove the pipeline works
3. **Extension integration** - Get Zed to recognize and load the extension
4. **Iterative grammar expansion** - Add syntax elements one at a time, testing each

# Risks and Mitigations

## Technical Challenges
- **AHK syntax is quirky** - Unquoted strings, flexible syntax. Mitigation: Start minimal, expand carefully
- **Tree-sitter learning curve** - First time creating a grammar. Mitigation: Follow existing simple grammars as examples
- **Zed extension debugging** - May be tricky. Mitigation: Use `zed --foreground` for logs

## MVP Definition
Phase 1 (comments working) is the MVP. If we get stuck on later phases, at least commenting will work.

# Appendix

## AHK v1 Syntax Elements to Parse

### Must Have (Phase 1)
- Line comments: `; this is a comment`
- Block comments: `/* multi-line */`

### Should Have (Phase 2-3)
- Strings: `"double"` and `'single'`
- Numbers: `123`, `0xFF`, `3.14`
- Keywords: `if`, `else`, `while`, `loop`, `return`, `class`, `global`, `local`, `break`, `continue`
- Functions: `MyFunc() { }` and `MyFunc()`
- Labels: `MyLabel:`
- Hotkeys: `^a::`, `#n::`, `!+c::`
- Directives: `#Include`, `#NoEnv`, `#SingleInstance`

### Nice to Have (Future)
- Variables: `%varName%`
- Operators: `:=`, `=`, `.=`, `+=`
- Hotstrings: `::btw::by the way`

## Key Files to Create
1. `extension.toml` - Zed extension manifest
2. `package.json` - Node.js project config
3. `grammar.js` - Tree-sitter grammar rules
4. `languages/autohotkey/config.toml` - Language settings
5. `languages/autohotkey/highlights.scm` - Syntax highlighting queries
</PRD>
